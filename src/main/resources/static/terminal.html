<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Docker Bridge Terminal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            background-color: black;
        }
        #terminal {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<div id="terminal"></div>
<script>
    const containerId = new URLSearchParams(window.location.search).get("id");
    const socket = new WebSocket(`ws://${location.host}/ws/bridge`);
    const term = new Terminal({
        cursorBlink: true,
        fontSize: 14,
        convertEol: true,
        fontFamily: "monospace",
        theme: {
            background: "#000000",
            foreground: "#ffffff"
        }
    });

    let connected = false;
    let cmdBuffer = '';

    term.open(document.getElementById("terminal"));
    term.writeln("âœ… ë¸Œë¦¿ì§€ í„°ë¯¸ë„ ì—°ê²° ì‹œë„ ì¤‘...");

    socket.addEventListener('open', () => {
        term.writeln("ðŸŸ¢ WebSocket ì—°ê²°ë¨. ì»¨í…Œì´ë„ˆ ID ì „ì†¡ ì¤‘...\n");
        socket.send(JSON.stringify({containerId}));
    });

    socket.addEventListener('message', event => {
        term.write(event.data);
        if (event.data.includes("âœ… bash ì„¸ì…˜ ì—°ê²° ì™„ë£Œ")) {
            connected = true;
        }
    });

    socket.addEventListener('close', () => {
        term.write("\nâŒ WebSocket ì—°ê²° ì¢…ë£Œë¨.");
        connected = false;
    });

    term.onData(data => {
        if (!connected) return;
        cmdBuffer += data;
        if (data === "\r") {
            socket.send(cmdBuffer.replace("\r", ""));
            cmdBuffer = '';
        }
    });
</script>
</body>
</html>
